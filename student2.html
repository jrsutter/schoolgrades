<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Grade Submission</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Roboto', sans-serif; background: #f3f4f6; margin: 0; padding: 20px; }
  h2 { text-align: center; color: #333; }
  .card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 500px; margin: 20px auto; }
  .card input { width: calc(100% - 16px); padding: 8px; margin: 6px 0; border-radius: 6px; border: 1px solid #ccc; }
  .card button { background: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; margin-top: 10px; }
  .card button:hover { background: #0056b3; }
  .success { color: green; font-weight: 500; margin-top: 10px; }
</style>
</head>
<body>

<h2>Submit Your Grade</h2>

<!-- Landing page -->
<div id="landingPage" class="card">
  <label>Enter Student Code:</label>
  <input type="text" id="studentCodeInput" maxlength="6" placeholder="Enter code">
  <button onclick="verifyCode()">Continue</button>
</div>

<!-- Main submission page -->
<div id="mainPage" class="card" style="display:none;">
  <label>Student ID (6 digits):</label>
  <input type="number" id="studentIdInput" min="0" max="999999" placeholder="123456">

  <label>Grade:</label>
  <input type="number" id="gradeInput" min="0" max="100" placeholder="Enter score">

  <button onclick="submitGrade()">Submit</button>
  <div id="successMsg" class="success"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzLVmYDPgo6y1XAkQxmC-f0mYX7Gliz0R6JTiVlATz5bYqiyzTpyMK7jqfWYrbgZ_4f/exec";

// -------------------- Landing Page --------------------
async function verifyCode() {
  const code = document.getElementById("studentCodeInput").value.trim();
  if (!code) return alert("Enter student code");

  try {
    const res = await fetch(`${SCRIPT_URL}?action=verifyCode&code=${encodeURIComponent(code)}`);
    const data = await res.json();

    if (data.valid) {
      document.getElementById("landingPage").style.display = "none";
      document.getElementById("mainPage").style.display = "block";
    } else {
      alert("Invalid code");
    }
  } catch (err) {
    console.error(err);
    alert("Error verifying code");
  }
}

// -------------------- Submit Grade with Countdown --------------------
async function submitGrade() {
  const studentId = document.getElementById("studentIdInput").value.trim();
  const grade = document.getElementById("gradeInput").value.trim();

  if (!studentId) return alert("Enter Student ID");
  if (studentId.length > 6) return alert("Student ID cannot exceed 6 digits");

  try {
    const payload = {
      action: "submitGrade",
      studentId,
      grade
    };

    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data.status === "success") {
      const successMsg = document.getElementById("successMsg");
      let count = 3;
      successMsg.textContent = `Grade submitted! (${count})`;

      // Clear inputs immediately
      document.getElementById("studentIdInput").value = "";
      document.getElementById("gradeInput").value = "";

      // Start countdown
      const countdown = setInterval(() => {
        count--;
        if (count > 0) {
          successMsg.textContent = `Grade submitted! (${count})`;
        } else {
          successMsg.textContent = "";
          clearInterval(countdown);
        }
      }, 1000);
    } else {
      alert("Failed to submit grade");
    }
  } catch (err) {
    console.error(err);
    alert("Error submitting grade");
  }
}
</script>

</body>
</html>
