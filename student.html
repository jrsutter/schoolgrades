<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Submission</title>
<style>
body{font-family:Arial,sans-serif;background:#f3f4f6;margin:0;padding:20px;}
h2{text-align:center;}
.card{background:#fff;padding:20px;border-radius:12px;max-width:500px;margin:20px auto;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.card input,.card select{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc;}
.card button{background:#007bff;color:#fff;padding:8px 12px;border:none;border-radius:6px;margin-top:10px;cursor:pointer;}
.card button:hover{background:#0056b3;}
.success{color:green;font-weight:500;margin-top:10px;}
</style>
</head>
<body>
<h2>Submit Your Grade</h2>

<div id="landingPage" class="card">
  <label>Enter Student Code:</label>
  <input type="text" id="studentCodeInput" maxlength="6">
  <button onclick="verifyCode()">Continue</button>
</div>

<div id="mainPage" class="card" style="display:none;">
  <label>Student ID (6 digits):</label>
  <input type="number" id="studentIdInput" min="0" max="999999">
  <label>Class:</label>
  <select id="classSelect"></select>
  <label>Grade:</label>
  <input type="number" id="gradeInput" min="0" max="100">
  <button onclick="submitGrade()">Submit</button>
  <div id="successMsg" class="success"></div>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwPZmQPtthZ-pDI0ayvSiO3_-w9u7nLScIZQtg1JILhrwu77N9CJeYoGGQeNY4HePVvNQ/exec";

async function verifyCode(){
  const code=document.getElementById("studentCodeInput").value.trim();
  if(!code) return alert("Enter code");
  const res=await fetch(`${SCRIPT_URL}?action=verifyCode&code=${encodeURIComponent(code)}`);
  const data=await res.json();
  if(data.valid){ document.getElementById("landingPage").style.display="none"; document.getElementById("mainPage").style.display="block"; loadClasses(); }
  else alert("Invalid code");
}

async function loadClasses(){
  const res=await fetch(`${SCRIPT_URL}?action=getClasses`);
  const classes=await res.json();
  const select=document.getElementById("classSelect");
  select.innerHTML="";
  classes.forEach(c=>{ const o=document.createElement("option"); o.value=c;o.textContent=c;select.appendChild(o);});
}

async function submitGrade(){
  const studentId=document.getElementById("studentIdInput").value.trim();
  const cls=document.getElementById("classSelect").value;
  const grade=document.getElementById("gradeInput").value.trim();
  if(!studentId||studentId.length>6) return alert("Enter valid student ID");
  const payload={studentId, class:cls, grade};
  const res=await fetch(`${SCRIPT_URL}?action=submitGrade`, {method:"POST",body:JSON.stringify(payload)});
  const data=await res.json();
  if(data.status==="success"){ document.getElementById("successMsg").textContent="Grade submitted!"; document.getElementById("studentIdInput").value=""; document.getElementById("gradeInput").value=""; }
  else alert("Failed to submit grade");
}
</script>
</body>
</html>
